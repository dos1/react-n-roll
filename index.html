<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=1024" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <title>AngularJS application architecture | Slideshow for talk on 3rd AngularJS Meetup in Poznań, 7th August 2014 | by Eryk Napierała @erykpiast</title>

        <meta name="description" content="Slideshow for talk on 3rd AngularJS Meetup in Poznań, 7th August 2014" />
        <meta name="author" content="Eryk Napierała" />

        <link href="http://fonts.googleapis.com/css?family=Open+Sans:regular,semibold,italic,italicsemibold|PT+Sans:400,700,400italic,700italic|PT+Serif:400,700,400italic,700italic" rel="stylesheet" />

        <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" />
        <link href="//cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.css" rel="stylesheet" />

        <link href="css/base.css" rel="stylesheet" />
        <link href="css/utc.css" rel="stylesheet" />
        <link href="css/guitar.css" rel="stylesheet" />
        

        <script src="https://fb.me/react-0.13.1.js"></script>
        <script src="https://fb.me/JSXTransformer-0.13.1.js"></script>


        <link rel="shortcut icon" href="images/favicon.ico" />
    </head>

    <body class="impress-not-supported">

        <div class="fallback-message">
            <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
            <p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p>
        </div>

        <div id="impress">

            <section id="slide1" class="step slide">
                <header class="page-header huge text-center">
                    <h1>React.js</h1>
                    <h2>Introduction</h2>
                </header>
                <div class="author text-center">
                    <a href="http://dosowisko.net/" rel="author">Sebastian Krzyszkowiak</a>@<a href="https://github.com/UsabilityTools">UsabilityTools.com</a>
                </div>
                <footer class="page-footer text-right">
                    <small>
                        <time datetime="2015-03-25">March 25th, 2015</time><br/>
                        Poznań
                    </small>
                </footer>
            </section>

            <section id="slide2" class="step slide">
                <header class="page-header text-center">
                    <h2>What is React? *</h2>
                </header>

                <p>
                A JavaScript library for building user interfaces.
                </p>

                
                <footer class="page-footer text-right bottom">
									<small>
										* Facebook don't hurt me
									</small>
                </footer>
            </section>

            <section id="slide3" class="step slide subslide">
								<header class="page-header text-center">
									<h2>Why it's so special?</h2>
								</header>

                <p>
                    <ul>
											<li>it's fast</li>
											<li>it's simple</li>
											<li>it's flexible</li>
										</ul>
                </p>
            </section>

            <section id="slide4" class="step slide subslide">
                <p class="big center">
										It's not a framework!<br/><br/>
										<small>It's a library.</small>
                </p>
            </section>

            <section id="slide4.5" class="step slide">
                <p class="big center">
									<strong>Components</strong>
                </p>
            </section>
            
            <section id="slide5" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>Components</h2>
                </header>

                <p class="text-center">
									<ul>
										<li>composable</li>
										<li>reusable</li>
										<li>maintainable</li>
										<li>testable</li>
										</ul>
                </p>
            </section>

            <section id="slide6" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>Components</h2>
                </header>

                <pre class="code-listing">
                <code class="language-javascript">var Kitteh = React.createClass({
	render: function() {
		return (
			&lt;img src="https://aroundustyroads.files.wordpress.com/2014/01/kitten.png" /&gt;
		);
	}
});
React.render(
	&lt;Kitteh /&gt;,
	document.getElementById('a-place-for-kitteh')
);</code>
</pre>
            </section>

            <section id="slide7" class="step slide subslide">
                <p class="big center" id="a-place-for-kitteh">
                    
                </p>
            </section>

            <section id="slide8" class="step slide subslide">
            <pre class="code-listing" style="padding-top: 0; padding-bottom: 0;">
            <code class="language-javascript" style="font-size: 0.8em; padding: 0">render: function() {
	return (
		&lt;img src="(...)" /&gt;
	);
}</code>
</pre>
                <p class="text-center" style="margin-top: -50px; position: relative;">
                    <img src="http://www.quickmeme.com/img/45/4547755c16e559dfddad6f7a725e499f9ac9169e0f2683db0b1f805c48943723.jpg" height="500" />
                </p>
            </section>

            <section id="slide8.5" class="step slide subslide">
            <header class="page-header text-center">
            <h2>JSX</h2>
            </header>
            <pre class="code-listing" style="padding-top: 0; padding-bottom: 0;">
            <code class="language-javascript language-jsx" style="padding: 0">render: function() {
	return (
		&lt;img src="(...)" /&gt;
	);
}</code>
</pre>
            <pre class="code-listing" style="padding-top: 0; padding-bottom: 0;">
            <code class="language-javascript" style="padding: 0">render: function() {
	return (
		React.createElement('img', { src: "(...)" })
	);
}</code>
</pre>
            </section>            
            
            <section id="slide9" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>Components</h2>
                </header>

                <p class="big center">
									Data flows <strong>one way</strong>!
                </p>
            </section>

            <section id="slide10" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>Components</h2>
                </header>

                <p class="big center">
									Data is <strong>immutable</strong>!
                </p>
            </section>            
            
            <section id="slide10.1" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>Components</h2>
                </header>

                <pre class="code-listing">
                <code class="language-javascript">var GlowinKitteh = React.createClass({
	render: function() {
		return (
			&lt;img src="https://aroundustyroads.files.wordpress.com/2014/01/kitten.png" style={{ boxShadow: "0px 0px 100px " + this.props.color }} /&gt;
		);
	}
	});
React.render(
	&lt;GlowinKitteh color="magenta" /&gt;,
	document.getElementById('a-place-for-glowin-kitteh')
);</code>
</pre>
            </section>

            <section id="slide10.2" class="step slide subslide">
                <p class="big center" id="a-place-for-glowin-kitteh">
                </p>
            </section>
            
            
            
            <section id="slide11" class="step slide">
                <header class="page-header text-center">
                    <h2>co dalej</h2>
                </header>

                <ul>
                    <li>stan - losowy kotek</li>
                    <li>handlery eventów - wylosuj kotka</li>
                    <li>why it's fast (full rerenders, virtual dom, diff)</li>
                    <li>componentDidMount, this.getDOMNode()</li>
                    <li>start making components - struny i nuty</li>
                    <li>pchanie danych w dół - grana nuta</li>
                    <li>pchanie danych do góry - wybór stroju</li>
                    <li>http://www.slideshare.net/AndrewHull/react-js-and-why-its-awesome?related=1</li>
                </ul>
            </section>
            
            <section id="slide11.5" class="step slide">
            
            <div id="detector" class="vague">
            <div class="pitch"><span id="pitch">--</span>Hz</div>
            <div class="note"><span id="note">--</span></div>   
            <canvas id="output" width=300 height=42></canvas>
            <div id="detune"><span id="detune_amt">--</span><span id="flat">cents &#9837;</span><span id="sharp">cents &#9839;</span></div>
            </div>
            
            </section>

            <section id="slide12" class="step slide">
                <header class="page-header text-center">
                    <h2>State – root</h2>
                </header>

                <pre class="code-listing">
                    <code class="language-javascript">
    define([
        'angular',

        'common/helpers/features/features',

        './sub/project/project.state.module',
        './sub/user/user.state.module',

        './views/header/root__header.view.module',
        './views/footer/root__footer.view.module',
        './views/sidebar/root__sidebar.view.module',
        './views/content/root__content.view.module',

        'ui.router',
        'restangular'
    ], function (
        angular,

        features,

        MProjectState,
        MUserState,

        MRootFooterView,
        MRootHeaderView,
        MRootSidebarView,
        MRootContentView
        ) {

        angular.module('app.root.state', features.toggle([
            (features.active('project') && MProjectState.name),
            (features.active('user') && MUserState.name),

            MRootHeaderView.name,
            MRootFooterView.name,
            MRootSidebarView.name,
            MRootContentView.name,

            'ui.router',
            'restangular'
        ]))
        .config(function (
            $stateProvider,

            VRootHeader,
            VRootFooter,
            VRootSidebar,
            VRootContent
        ) {

            $stateProvider
                .state('root', {
                    url: '/',
                    views: {
                        'header@': VRootHeader,
                        'footer@': VRootFooter,
                        'sidebar@': VRootSidebar,
                        'content@': VRootContent
                    }
                });
        });
    });
                    </code>
                </pre>
            </section>

            <section id="slide13" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>State – root.project</h2>
                </header>

                <pre class="code-listing">
                    <code class="language-javascript">
    angular.module('app.project.state', features.toggle([
        (features.active('project.list') && MProjectListState.name),
        (features.active('project.add') && MProjectAddState.name),
        (features.active('project.one') && MProjectOneState.name),

        'ui.router'
    ]))
    .config(function (
        $stateProvider
    ) {
        $stateProvider
            .state('root.authenticated.project', {
                url: '/project',
                abstract: true,
                resolve: {
                    RProject: function() {
                        return MProjects.service('project');
                    }
                }
            });
    });
                    </code>
                </pre>
            </section>

            <section id="slide14" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>State – root.project.one</h2>
                </header>

                <pre class="code-listing">
                    <code class="language-javascript">
    var stateName = 'root.project.one';

    angular.module('app.project__one.state', features.toggle([
        (features.active('project.one.recording') && MProjectOneRecordingState.name),
        (features.active('project.one.script') && MProjectOneScriptState.name),
        (features.active('project.one.edit') && MProjectOneEditState.name),

        MProjectHeaderView.name,

        'ui.router',
        'restangular'
    ]))
    .config(function (
        $stateProvider,
        RestangularProvider,

        VProjectOneHeader
    ) {
        $stateProvider
            .state(stateName, {
                url: '/{projectId:[0-9a-z]{4,}}',
                abstract: true,
                views: {
                    'header@': VProjectOneHeader
                },
                resolve: {
                    MProject: function(MProjects, $stateParams) {
                        return MProjects.get($stateParams.projectId);
                    }
                },
                onEnter: function(MProjects, $stateParams) {
                    MProjects.current = MProjects.filter(function(project) {
                        return (project.id === $stateParams.projectId);
                    })[0];
                },
                onExit: function(MProjects) {
                    MProjects.current = null;
                }
            });
    })
    .run(function(
        $rootScope,
        $state
    ) {
        $rootScope
            .$on('$stateChangeError', function(e, toState) {
                if(!e.defaultPrevented && (toState.name.indexOf(stateName) === 0)) {
                    e.preventDefault();

                    $state.go('^.list', { }, {
                        location: 'replace',
                        relative: stateName
                    });
                }
            });
    });
                    </code>
                </pre>
            </section>

            <section id="slide15" class="step slide">
                <header class="page-header text-center">
                    <h2>View</h2>
                </header>

                <p class="text-center">
                    <a href="images/wireframe-simple.png">
                        <img src="images/wireframe-simple.png" height="500px" >
                    </a>
                </p>
            </section>

            <section id="slide16" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>View</h2>
                </header>

                <p class="text-center">
                    <a href="images/wireframe-complicated.png">
                        <img src="images/wireframe-complicated.png" height="500px" >
                    </a>
                </p>
            </section>

            <section id="slide17" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>View</h2>
                </header>

                <p class="text-center">
                    <a href="images/structure-utc-view.png">
                        <img src="images/structure-utc-view.png" height="500px" >
                    </a>
                </p>
            </section>

            <section id="slide18" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>View</h2>
                </header>

                <ul>
                    <li>defines pair template-controller and exposes it for state</li>
                    <li>can define its own components</li>
                    <li>depends on its ancestors</li>
                    <li>it's a leaf of the app tree – it hasn't children</li>
                </ul>
            </section>

            <section id="slide19" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>View – project__list__content</h2>
                </header>

                <pre class="code-listing">
                    <code class="language-javascript">
    define([
        'angular',

        'text!./project__list__content.view.template.html',

        './directives/project__list__content.directives.module',
        './services/project__list__content.services.module'
    ], function (
        angular,

        TProjectListContent,

        MProjectListContentDirectives,
        MProjectListContentServices
        ) {

        angular.module('ts.project__list__content.view', [
            MProjectListContentDirectives.name,
            MProjectListContentServices.name
        ])
        .constant('VProjectListContent', {
            template: TProjectListContent,
            controller: 'ts.project__list__content'
        });

    });
                    </code>
                </pre>
            </section>

            <section id="slide20" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>View – component</h2>
                </header>

                <ul>
                    <li>can use components defined by all its ancestors (view, state, grand-state etc.)</li>
                    <li>controllers manages single template</li>
                    <li>services, filters and directives can use one another</li>
                    <li>any app part <strong>outside the view</strong> can't (or rather mustn't) use component defined by the view</li>
                </ul>
            </section>

            <section id="slide21" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>View controller – project__list__content</h2>
                </header>

                <pre class="code-listing">
                    <code class="language-javascript">
    define([
        './project__list__content.view.module'
    ], function (MProjectListContent) {

        MProjectListContent.controller('ts.project__list__content',
            function ($scope, MProjects) {
                $scope.projects = MProjects;
            });

    });
                    </code>
                </pre>
            </section>

            <section id="slide22" class="step slide">
                <header class="page-header text-center">
                    <h2>Shared components</h2>
                </header>

                <ul>
                    <li>can use components defined by all its ancestors (view, state, grand-state etc.)</li>
                    <li>no controllers!</li>
                    <li>services, filters and directives can use one another and can be used by children's components</li>
                    <li>any app part <strong>above the state</strong> can't (or rather mustn't) use component defined by the view</li>
                </ul>
            </section>

            <section id="slide23" class="step slide">
                <header class="page-header text-center">
                    <h2>Naming conventions</h2>
                </header>

                <p>For files</p>
                <ul>
                    <li>*.module.js, *.directive.js, *.service.js</li>
                    <li>*.state.module.js, *.view.controller.js</li>
                    <li><a href="http://bem.info/">BEM</a> – project__list.*, recording__one__content.*</li>
                </ul>
                <p>For app components and variables</p>
                <ul>
                    <li>app.project__list.state, app.project__list__content.view</li>
                    <li><a href="http://en.wikipedia.org/wiki/Hungarian_notation">Hungarian Notation</a> – MProjectListContent, VProjectListContent</li>
                </ul>
            </section>

            <section id="slide24" class="step slide">
                <header class="page-header text-center">
                    <h2>Build process</h2>
                </header>

                <ul>
                    <li>configuration of single task in separate file (see <a href="https://www.npmjs.org/package/load-grunt-configs">load-grunt-configs</a>)</li>
                    <li>meaningless tasks are grouped (ex. <a href="https://www.npmjs.org/package/grunt-nestedtasksrunner">grunt-nestedtasksrunner</a>)</li>
                    <li>dist configs are a base for dev ones</li>
                </ul>
            </section>

            <section id="slide25" class="step slide">
                <p class="big center">
                    <strong>Benefits</strong>
                </p>
            </section>

            <section id="slide26" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>Damn easy feature toggle!</h2>
                </header>

                <p class="text-center">
                    <a href="images/structure-utc-feature-toggle.png">
                        <img src="images/structure-utc-feature-toggle.png" height="500px" >
                    </a>
                </p>
            </section>

            <section id="slide27" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>Damn fast finding files!</h2>
                </header>

                <p class="text-center">
                    <a href="images/structure-utc-finding-files.png">
                        <img src="images/structure-utc-finding-files.png" height="500px" >
                    </a>
                </p>
            </section>

            <section id="slide28" class="step slide subslide">
                <header class="page-header text-center">
                    <h2>All is all right</h2>
                </header>

                <ul>
                    <li>easy to determine which components are required for particular feature</li>
                    <li>clear connections between components</li>
                    <li>communication through the nearest common ancestor (except exceptions...)</li>
                    <li>able to further scaling up</li>
                </ul>
            </section>

            <section id="slide29" class="step slide">
                <header class="page-header text-center">
                    <h2>Pitfails or trade offs?</h2>
                </header>

                <p class="big center">
                    <strong>Tell me!</strong>
                </p>
            </section>

            <section id="slide30" class="step slide">
                <header class="page-header text-center">
                    <h2>If you like it – try it (and contribute)</h2>
                </header>

                <p class="center">
                    <a href="https://github.com/UsabilityTools/angular-require-seed">angular-require-seed</a>
                </p>
            </section>

            <section id="slide31" class="step slide">

                <p class="big center">
                    <strong>Thank you!</strong><br>
                    <small style="font-size: 50%;">
                        <a href="https://github.com/erykpiast" rel="author">Eryk Napierała</a>@<a href="https://github.com/UsabilityTools">UsabilityTools.com</a>
                    </small>
                </p>
            </section>

        </div>

        <aside class="content-index panel panel-default">
            <header class="page-header panel-header">
                <h2>Table of contents</h2>
            </header>

            <button type="button" class="btn btn-default content-index-trigger">
                <i class="glyphicon glyphicon-th"></i>
            </button>
            <nav class="panel-body content-index-list"></nav>
        </aside>

        <script src="//cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.js"></script>
        <script>
            var contentIndex = [ ];

            var subSlideIdx = 0, subSlideCount = 0, lastHeader;

            Array.prototype.forEach.call(document.querySelectorAll('[id^="slide"]'), function(slide, index) {
                if (slide.classList.contains('subslide')) {
									subSlideIdx++;
									subSlideCount++;
                } else {
									subSlideIdx = 0;
                }

                slide.setAttribute('data-y', - ((index - subSlideCount) * 600));
                slide.setAttribute('data-x', (index * 1000) + (subSlideCount * 150));
                slide.setAttribute('data-z', ((index - subSlideCount) * 1500));

                var header = slide.querySelector('.page-header > h2');

                if (header && (header.innerHTML != lastHeader)) {
                    contentIndex.push({
                        title: header.innerHTML,
                        id: slide.getAttribute('id')
                    });
										
										lastHeader = header.innerHTML;
                }
            });

            document.querySelector('.content-index-list').innerHTML = (contentIndex.reduce(function(prev, curr) {
                return (prev + '<li class="content-index-list-item"><a href="#' + curr.id + '">' + curr.title + '</a></li>');
            }, '<ul class="nav nav-pills nav-stacked content-index-list">') + '</ul>');
        </script>
        <script src="js/impress.js"></script>
        <script>impress().init();</script>
        <script>
        /*
				 T he M*IT License (MIT)

				 Copyright (c) 2014 Chris Wilson

				 Permission is hereby granted, free of charge, to any person obtaining a copy
				 of this software and associated documentation files (the "Software"), to deal
				 in the Software without restriction, including without limitation the rights
				 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
				 copies of the Software, and to permit persons to whom the Software is
				 furnished to do so, subject to the following conditions:

				 The above copyright notice and this permission notice shall be included in all
				 copies or substantial portions of the Software.

				 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
				 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
				 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
				 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
				 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
				 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
				 SOFTWARE.
				 */
				(function() {

					var audioContext = null;
					var meter = null;
					var canvasContext = null;
					var WIDTH=500;
					var HEIGHT=50;
					var rafID = null;


					/*
					 *
					 * Usage:
					 * audioNode = createAudioMeter(audioContext,clipLevel,averaging,clipLag);
					 *
					 * audioContext: the AudioContext you're using.
					 * clipLevel: the level (0 to 1) that you would consider "clipping".
					 *   Defaults to 0.98.
					 * averaging: how "smoothed" you would like the meter to be over time.
					 *   Should be between 0 and less than 1.  Defaults to 0.95.
					 * clipLag: how long you would like the "clipping" indicator to show
					 *   after clipping has occured, in milliseconds.  Defaults to 750ms.
					 *
					 * Access the clipping through node.checkClipping(); use node.shutdown to get rid of it.
					 */

					function createAudioMeter(audioContext,clipLevel,averaging,clipLag) {
						var processor = audioContext.createScriptProcessor(512);
						processor.onaudioprocess = volumeAudioProcess;
						processor.clipping = false;
						processor.lastClip = 0;
						processor.volume = 0;
						processor.clipLevel = clipLevel || 0.98;
						processor.averaging = averaging || 0.95;
						processor.clipLag = clipLag || 250;

						// this will have no effect, since we don't copy the input to the output,
						// but works around a current Chrome bug.
						processor.connect(audioContext.destination);

						processor.checkClipping =
						function(){
							if (!this.clipping)
								return false;
							if ((this.lastClip + this.clipLag) < window.performance.now())
								this.clipping = false;

							return this.clipping;
						};

						processor.shutdown =
						function(){
							this.disconnect();
							this.onaudioprocess = null;
						};

						return processor;
					}

					function volumeAudioProcess( event ) {
						var buf = event.inputBuffer.getChannelData(0);
						var bufLength = buf.length;
						var sum = 0;
						var x;

						// Do a root-mean-square on the samples: sum up the squares...
						for (var i=0; i<bufLength; i++) {
							x = buf[i];
							if (Math.abs(x)>=this.clipLevel) {
								this.clipping = true;
								this.lastClip = window.performance.now();
							}
							sum += x * x;
						}

						// ... then take the square root of the sum.
						var rms =  Math.sqrt(sum / bufLength);

						// Now smooth this out with the averaging factor applied
						// to the previous sample - take the max here because we
						// want "fast attack, slow release."
						this.volume = Math.max(rms, this.volume*this.averaging);
					}

					window.onload = function() {

						// grab our canvas
						//canvasContext = document.getElementById( "meter" ).getContext("2d");

						// monkeypatch Web Audio
						window.AudioContext = window.AudioContext || window.webkitAudioContext;

						// grab an audio context
						audioContext = new AudioContext();

						// Attempt to get audio input
						try {
							// monkeypatch getUserMedia
							navigator.getUserMedia =
							navigator.getUserMedia ||
							navigator.webkitGetUserMedia ||
							navigator.mozGetUserMedia;

							// ask for an audio input
							navigator.getUserMedia(
								{
									"audio": {
										"mandatory": {
											"googEchoCancellation": "false",
											"googAutoGainControl": "false",
											"googNoiseSuppression": "false",
											"googHighpassFilter": "false"
										},
										"optional": []
									},
								}, gotStream, didntGetStream);
						} catch (e) {
							alert('getUserMedia threw exception :' + e);
						}

					}


					function didntGetStream() {
						alert('Stream generation failed.');
					}

					var mediaStreamSource = null;

					function gotStream(stream) {
						startPitch();
						
						// Create an AudioNode from the stream.
						mediaStreamSource = audioContext.createMediaStreamSource(stream);

						// Create a new volume meter and connect it.
						meter = createAudioMeter(audioContext);
						mediaStreamSource.connect(meter);

						// kick off the visual updating
						drawLoop();
					}

					var lastNotClip = 0;

					function nextSlideChecker(clip) {
						//console.log(clip);
						if (!clip) lastNotClip = window.performance.now();
				 if (clip) {
					 if ((lastNotClip != 0) && (lastNotClip + 1000 < window.performance.now())) {
						 lastNotClip = 0;
						 if (!(document.body.classList.contains("guitarLocked"))) impress().next();
					 }
				 }
					}

					function drawLoop( time ) {
						// clear the background
						//canvasContext.clearRect(0,0,WIDTH,HEIGHT);

						// check if we're currently clipping
						if (meter.checkClipping()) {
							//canvasContext.fillStyle = "red";
							document.body.classList.add("clipping");
							nextSlideChecker(true);
						} else {
							//canvasContext.fillStyle = "green";
							document.body.classList.remove("clipping");
							nextSlideChecker(false);
						}

						// draw a bar based on the current volume
						//canvasContext.fillRect(0, 0, meter.volume*WIDTH*1.4, HEIGHT);

						// set up the next visual callback
						rafID = window.requestAnimationFrame( drawLoop );
					}
					
					window.addEventListener("keypress", function(ev) { 
						if (ev.which == 122) document.body.classList.toggle("guitarLocked");
					});

				})();
        </script>
        <script type="text/jsx" src="js/react.js"></script>
        <script src="pd/js/pitchdetect.js"></script>
    </body>
</html>
